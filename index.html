<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>jdybnis/memcached @ GitHub</title>

    <style type="text/css">
      body {
        margin-top: 1.0em;
        background-color: #cfd5d8;
        font-family: "helvetica"; 
        color: #000000;
      }
      #container {
        margin: 0 auto;
        width: 700px;
      }
      h1 { font-size: 2.8em; color: #302a27; margin-bottom: 3px; }
      h1 .small { font-size: 0.4em; }
      h1 a { text-decoration: none }
      h2 { font-size: 1.5em; color: #302a27; }
      h3 { text-align: center; color: #302a27; }
      a { color: #302a27; }
      .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
      .download { float: right; }
      pre { background: #000; color: #fff; padding: 15px;}
      hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
      .footer { text-align:center; padding-top:30px; font-style: italic; }
    </style>

  </head>

  <body>
    <div id="container">

      <div class="download">
        <a href="http://github.com/jdybnis/memcached/zipball/master">
          <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
        <a href="http://github.com/jdybnis/memcached/tarball/master">
          <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
      </div>

      <h1>
        <a href="http://github.com/jdybnis/memcached">memcached-prefix</a><br>
        <span class="small">by <a href="http://github.com/jdybnis">jdybnis</a></small>
      </h1>

      <div class="description">
        <p>This is an experimental fork of memcached based off of Dustin Sallings' master branch. 
        This branch adds prefix and range commands to the protocol. The new commands are <b>pget</b>, 
        <b>pdelete</b> and <b>rget</b>.</p>
        <p>The cache is implemented with a skiplist instead of the normal hashtable. Even so, its 
        performance is very close to the standard memcached (see the benchmarks below). Space usage 
        is also roughly unchanged. Each item in the skiplist uses an average of 3 bytes more than it 
        would use in the hashtable</p>
      </div>

      <h2>New Commands</h2>

      <pre>pget key_prefix max_items [continue_key]</pre>

      <p>pget instructs the server to send back any items that have keys beginning with the key_prefix. The
      server will send the items in lexographic order by key. max_items is the maximum number of items 
      that the server will send in response to a single command. max_items cannot be greater than 100.
      The client can use a continue_key to retrieve more. If the command includes a continue_key then 
      the server will only send back items that match the key_prefix and are lexographically after the
      continue_key.</p>
      <p>If the client issues a pget and the server sends back the maximum number of items, the client 
      should assume that there might still be other unsent items on the server that match the key_prefix. 
      The client should issue another pget with the continue_key equal to the key of the last item from 
      the previous pget, the server will respond with the next batch of items in lexographic order.</p>

      <pre>pdelete key_prefix</pre>

      <p>pdelete instructs the server to delete all items that have keys beginning in key_prefix.</p>

      <pre>rget start end start_is_open end_is_open max_items</pre>

      <p>rget is the same as in memcachedb. See the memcachedb docs for usage instructions.</p>

      <p><i>Note: these commands are not standard and may very well change between versions.</i></p>

      <h2>Benchmarks</h2>
      <h3>Setup</h3>
      <p>The following are benchmarks of memcached-prefix and memcached v1.2.6. The benchmarks were
      run on a Core i7 920 w/ 12GB RAM and HT enabled. The client was libmemcached based, running in 
      loopback mode against a multi-threaded server on the same machine.</p>
      <p>The benchmark starts out by loading items into an empty cache until the cache contains a number
      of items determined by the run parameters (the x axis of the graphs below). Then for a period of 10
      seconds the client issues random commands in the ratio of 90% get to 5% add and 5% delete, and 
      measures the number of operations completed per second. The reported measurements are averages of
      multiple runs.</p>
      <h3>Results</h3>
      <p>The first graph shows that there is a remarkably small decrease in maximum throughput between 
      the standard version of version of memcached (hashtable based) and memcached-prefix (skiplist 
      based). With 100 million items in the cache, the maximum throughput of memcached-prefix is still 
      close to 100,000 ops/sec.</p>
      <img src="compare.png">
      <p>The second graph shows that if the cpu usage is less than 67% (per-core) running the standard 
      memcached, then memcached-prefix will be able to handle that same load on that same machine. This
      figure (67%) assumes both that there are 100 million items in the cache and that the client and
      server are running on the same machine. When there are fewer items in the cache or the network 
      overhead is higher then that number will be even higher.</p>
      <img src="compare_cpu.png">
      <p>Note: The keys and values used in the above benchmarks were all 8 bytes. This made more items
      fit into the cache than normal, thereby simulating a server with more RAM. The following graph 
      shows that the results still apply for normal sized keys and values. Using larger keys and values
      only changes the results by a small constant factor.</p>
      <img src="sizes.png">

      <h2>Download</h2>
      <p> You can download this project in either
      <a href="http://github.com/jdybnis/memcached/zipball/master">zip</a> or
      <a href="http://github.com/jdybnis/memcached/tarball/master">tar</a> formats.  </p>
      <p> You can also clone the project with <a href="http://git-scm.com">Git</a> by running:
      <pre>$ git clone git://github.com/jdybnis/memcached</pre> </p>

      <div class="footer">
        get the source code on GitHub : <a href="http://github.com/jdybnis/memcached">jdybnis/memcached</a>
      </div>

      <h2>Contact</h2>
      <p>Josh Dybnis (jdybnis@gmail.com)</p>

    </div>

    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script>
      <script type="text/javascript">
        try {
          var pageTracker = _gat._getTracker("UA-6252904-2");
          pageTracker._trackPageview();
        } catch(err) {}</script>
    </body>
  </html>
